<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">        

        <title>Form Template</title>

        <script type="module">
            import SelectorSubscriber from "https://jamesaduncan.github.io/selector-subscriber/index.mjs";

            SelectorSubscriber.subscribe("form[target]", ( aForm ) => {
                aForm.addEventListener('submit', async ( theEvent ) => {

                    const formdata    = new FormData( theEvent.target );
                    const destination = document.querySelector( theEvent.target.getAttribute('target') );
                    const template    = ( theEvent.target.hasAttribute('template') ) ? document.querySelector( theEvent.target.getAttribute('template') ) 
                                                                                     : destination.querySelector('template'); 

                    const clone = template.content.cloneNode( true );
                    Array.from( formdata.keys() ).forEach( (key) => {
                        try {
                            clone.querySelector(`slot[name=${key}]`).replaceWith( document.createTextNode( formdata.get( key ) ) );
                        } catch(e) {
                            console.warn(e);
                        }
                    });

                    theEvent.preventDefault();
                    destination[ theEvent.target.getAttribute('mutation') || "appendChild" ]( clone );
                });
            });
        </script>

        <script type="module">
            /* this just makes our code examples easier to inline */
            class ExampleCode extends HTMLElement {
                connectedCallback() {
                    const exampleCode = this.innerHTML;
                    const shadowRoot = this.attachShadow( { mode: "open" } );
                    const code = document.createElement('code');
                    code.innerText = exampleCode;
                    shadowRoot.appendChild( code )
                }
            }
            customElements.define("example-code", ExampleCode);
        </script> 
    </head>
    <body>
        <h1>Form Template example</h1>
        <p>
            Form templates link forms to templates in an HTML document. When the form is submitted,
            the template is cloned, filled out from the form inputs, and then inserted into the DOM.
        </p>
        
        <example-code>
            <form id="template-form" target="table tbody" template="template#template-form-template" mutation="replaceWith"></form>
        </example-code>
        <table>
            <thead>
                <tr>
                    <th type="col">Name</th>
                    <th type="col">Email</th>
                </tr>       
            </thead>
            <tbody>
                <tr>
                    <td>james@icloud.com</td>
                    <td>james@icloud.com</td>                        
                </tr>                
            </tbody>
            <tfoot>
                <tr>
                <td><input form="template-form" type="text" name="name" placeholder="Enter a name..."></td>
                <td><input form="template-form" type="email" name="email" placeholder="Enter an email address..."></td>
                <td><button form="template-form">Add</button></td>
                </tr>
            </tfoot>
        </table>

        <template id="template-form-template">
            <tbody>
                <tr>
                    <td><slot name="name">A name goes here</slot></td>
                    <td><slot name="email">An email address goes here</slot></td>                        
                    <td><button>Delete</button></td>
                </tr>
            </tbody>
        </template>

    </body>
</html>